{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h1>Administration</h1>

    <!-- Affichage des messages flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container mt-3">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}" role="alert">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <!-- Section : Les moniteurs et leurs cours -->
    <h2>Les moniteurs et leurs cours</h2>
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th>#</th>
                <th>Prénom</th>
                <th>Nom</th>
                <th>Nombre de cours réalisés</th>
                <th>Total d'heures prévues</th>
            </tr>
        </thead>
        <tbody>
            {% for moniteur in moniteurs %}
                <tr>
                    <td>{{ moniteur[0] }}</td>
                    <td>{{ moniteur[1] }}</td>
                    <td>{{ moniteur[2] }}</td>
                    <td>{{ moniteur[3] }}</td>
                    <td>{{ moniteur[4] }} h</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="5" class="text-center">Aucun moniteur trouvé.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Graphique des heures prévues -->
    <h2>Graphique des heures de cours pour les moniteurs</h2>
    <canvas id="graph_moniteurs" width="400" height="200"></canvas>

    <!-- Section : Les personnes du site et leurs rôles -->
    <h2>Les personnes du site et leurs rôles</h2>
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th>Prénom</th>
                <th>Nom</th>
                <th>Rôle</th>
            </tr>
        </thead>
        <tbody>
            {% for utilisateur in utilisateurs %}
                <tr>
                    <td>{{ utilisateur[1] }}</td>
                    <td>{{ utilisateur[2] }}</td>
                    <td>{{ utilisateur[3] }}</td>
                    <td>
                        <form action="{{ url_for('passer_moniteur') }}" method="POST">
                            <input type="text" name="id" value="{{ utilisateur[0] }}" id="id" hidden>
                            <button type="submit" class="btn btn-primary">Mettre Moniteur</button>
                        </form>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="3" class="text-center">Aucune personne trouvée.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>


    <h2>Les poneys du club : </h2>
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th>Nom</th>
                <th>Charge Max</th>
            </tr>
        </thead>
        <tbody>
            {% for idPoney, details in dico_poney.items() %}
                <tr>
                    <td>{{ idPoney }}</td>
                    <td>{{ details.charge_max }}</td>
                    <td>{{ details.nomPoney }}</td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="3" class="text-center">Aucun poney trouvé.</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

  
    <div class="mt-4">
        <a href="{{ url_for('create_moniteur') }}" class="btn btn-success mt-3">Créer un Moniteur</a>
        <a href="{{ url_for('admin_create_cours') }}" class="btn btn-primary mt-3">Créer un Cours</a>
        <a href="{{ url_for('ajouter_poney') }}" class="btn btn-primary mt-3">Ajouter un poney</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Récupérer les données injectées depuis Flask
    const chartLabels = {{ labels | tojson }};
    const data = {{ data | tojson }};
    const colors = {{ colors | tojson }};

    // Initialisation du graphique
    const ctx = document.getElementById('graph_moniteurs').getContext('2d');
    const moniteurChart = new Chart(ctx, {
        type: 'pie', // Choix du graphique (camembert)
        data: {
            labels: chartLabels, // Noms des moniteurs
            datasets: [{
                label: 'Total d\'heures de cours',
                data: data, // Heures totales
                backgroundColor: colors, // Couleurs
                borderColor: colors.map(c => c.replace('0.5', '1.0')), // Bordures
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return `${tooltipItem.label}: ${tooltipItem.raw} heures`;
                        }
                    }
                }
            }
        }
    });
</script>
{% endblock %}
